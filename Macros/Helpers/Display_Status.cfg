[gcode_macro M73]
rename_existing: M9973
gcode: 
	{% set printcfg = printer['gcode_macro _printcfg'] %}
	SET_GCODE_VARIABLE MACRO=_printcfg VARIABLE=remaining_time VALUE={params.R}
	SET_GCODE_VARIABLE MACRO=_printcfg VARIABLE=remaining_hour VALUE={params.R|int // 60}
	SET_GCODE_VARIABLE MACRO=_printcfg VARIABLE=remaining_min VALUE={params.R|int % 60}
	M9973 P{params.P|int}

[delayed_gcode _print_status_msg]
gcode: 
	{% set printcfg = printer['gcode_macro _printcfg'] %}
	{% if printcfg.remaining_hour > 0 %}
	M117 {printcfg.remaining_hour}h{printcfg.remaining_min}m L{printer.print_stats.info.current_layer}/{printer.print_stats.info.total_layer}
	{% elif printcfg.remaining_min > 0 %}
	M117 {printcfg.remaining_min}m L{printer.print_stats.info.current_layer}/{printer.print_stats.info.total_layer}
	{% else %}
	M117 <1m L{printer.print_stats.info.current_layer}/{printer.print_stats.info.total_layer}
	{% endif %}
	UPDATE_DELAYED_GCODE ID=_print_status_msg DURATION={printcfg.print_status_msg_update_time}

[gcode_macro PRINT_STATUS_MSG_UPDATE]
gcode: 
	{% set DUR = params.DURATION|default(30)|int %}
	SET_GCODE_VARIABLE MACRO=_printcfg VARIABLE=print_status_msg_update_time VALUE={DUR}
	UPDATE_DELAYED_GCODE ID=_print_status_msg DURATION={DUR}

[gcode_macro PRINT_STATUS_MSG_STOP]
gcode: 
	UPDATE_DELAYED_GCODE ID=_print_status_msg DURATION=0
	M117

[delayed_gcode clear_display]
gcode: 
	M117
	STATUS_OFF
