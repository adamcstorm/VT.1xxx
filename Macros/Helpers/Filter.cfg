[gcode_macro START_FILTER]
gcode: 
	{% set SPEED = params.SPEED|default(1)|float %}
	_SET_FILTER_SPEED SPEED={SPEED}

[gcode_macro STOP_FILTER]
gcode: 
	_SET_FILTER_SPEED SPEED=0

[delayed_gcode _STOP_FILTER_DELAYED]
gcode: 
	STOP_FILTER

[gcode_macro _SET_FILTER_SPEED]
gcode: 
	{% set printcfg = printer['gcode_macro _printcfg'] %}
	{% set filter_enabled = printcfg.filter_enabled %}
	{% set filter_name = printcfg.filter_name|default("")|string %}
	
	{% set SPEED = params.SPEED|default(0)|float %}
	
	{% if filter_enabled and filter_name != "" %}
    	SET_FAN_SPEED FAN={filter_name} SPEED={SPEED}
	{% endif %}